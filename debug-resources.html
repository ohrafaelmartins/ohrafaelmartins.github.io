<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Recursos da Landing Page</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .debug-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 5px 10px; border-radius: 4px; margin: 5px 0; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .image-test { display: inline-block; margin: 10px; text-align: center; }
        .image-test img { max-width: 200px; max-height: 150px; border: 2px solid #ddd; }
    </style>
</head>
<body>
    <h1>🔧 Debug - Recursos da Landing Page</h1>
    
    <div class="debug-section">
        <h2>Controles de Cache</h2>
        <button onclick="clearAllCache()">Limpar Todo Cache</button>
        <button onclick="unregisterServiceWorker()">Desregistrar Service Worker</button>
        <button onclick="location.reload(true)">Hard Reload</button>
        <button onclick="testAllResources()">Testar Recursos</button>
    </div>

    <div class="debug-section">
        <h2>Status do Service Worker</h2>
        <div id="sw-status"></div>
    </div>

    <div class="debug-section">
        <h2>Teste de Imagens WebP</h2>
        <div id="webp-test"></div>
        <div id="image-display"></div>
    </div>

    <div class="debug-section">
        <h2>Teste de Facebook Pixel</h2>
        <div id="fb-pixel-test"></div>
    </div>

    <div class="debug-section">
        <h2>Cache Status</h2>
        <div id="cache-status"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            const div = document.createElement('div');
            div.className = `status ${type === 'error' ? 'error' : type === 'success' ? 'success' : 'warning'}`;
            div.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            return div;
        }

        async function clearAllCache() {
            try {
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => caches.delete(name)));
                    document.getElementById('cache-status').appendChild(log('Cache limpo com sucesso', 'success'));
                }
            } catch (error) {
                document.getElementById('cache-status').appendChild(log(`Erro ao limpar cache: ${error.message}`, 'error'));
            }
        }

        async function unregisterServiceWorker() {
            try {
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    await Promise.all(registrations.map(reg => reg.unregister()));
                    document.getElementById('sw-status').appendChild(log('Service Worker desregistrado', 'success'));
                }
            } catch (error) {
                document.getElementById('sw-status').appendChild(log(`Erro ao desregistrar SW: ${error.message}`, 'error'));
            }
        }

        async function testWebPImages() {
            const images = ['capa-ebook.webp', 'turista-confuso.webp'];
            const container = document.getElementById('webp-test');
            const displayContainer = document.getElementById('image-display');
            
            for (const imageName of images) {
                try {
                    const response = await fetch(imageName);
                    if (response.ok) {
                        container.appendChild(log(`✅ ${imageName} - OK (${response.headers.get('content-type')})`, 'success'));
                        
                        // Exibir a imagem
                        const imgDiv = document.createElement('div');
                        imgDiv.className = 'image-test';
                        imgDiv.innerHTML = `
                            <img src="${imageName}" alt="${imageName}" onload="console.log('Imagem carregada: ${imageName}')" onerror="console.log('Erro ao carregar: ${imageName}')">
                            <div>${imageName}</div>
                        `;
                        displayContainer.appendChild(imgDiv);
                    } else {
                        container.appendChild(log(`❌ ${imageName} - ${response.status} ${response.statusText}`, 'error'));
                    }
                } catch (error) {
                    container.appendChild(log(`❌ ${imageName} - Erro de rede: ${error.message}`, 'error'));
                }
            }
        }

        async function testFacebookPixel() {
            const container = document.getElementById('fb-pixel-test');
            
            try {
                const response = await fetch('https://connect.facebook.net/en_US/fbevents.js', { mode: 'no-cors' });
                container.appendChild(log('Facebook Pixel: Tentativa de conexão feita', 'warning'));
            } catch (error) {
                container.appendChild(log(`Facebook Pixel: ${error.message} (normal se bloqueado)`, 'warning'));
            }
            
            if (typeof fbq !== 'undefined') {
                container.appendChild(log('Facebook Pixel: fbq function disponível', 'success'));
            } else {
                container.appendChild(log('Facebook Pixel: fbq function não encontrada', 'warning'));
            }
        }

        async function checkServiceWorker() {
            const container = document.getElementById('sw-status');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    if (registrations.length > 0) {
                        registrations.forEach((reg, index) => {
                            container.appendChild(log(`Service Worker ${index + 1}: ${reg.active?.scriptURL || 'Inativo'}`, 'success'));
                            container.appendChild(log(`Estado: ${reg.active?.state || 'N/A'}`, 'info'));
                        });
                    } else {
                        container.appendChild(log('Nenhum Service Worker registrado', 'warning'));
                    }
                } catch (error) {
                    container.appendChild(log(`Erro ao verificar SW: ${error.message}`, 'error'));
                }
            } else {
                container.appendChild(log('Service Worker não suportado', 'error'));
            }
        }

        async function testAllResources() {
            document.getElementById('webp-test').innerHTML = '';
            document.getElementById('image-display').innerHTML = '';
            document.getElementById('fb-pixel-test').innerHTML = '';
            document.getElementById('sw-status').innerHTML = '';
            document.getElementById('cache-status').innerHTML = '';
            
            await testWebPImages();
            await testFacebookPixel();
            await checkServiceWorker();
            
            const cacheNames = await caches.keys();
            document.getElementById('cache-status').appendChild(log(`Caches ativos: ${cacheNames.join(', ') || 'Nenhum'}`, 'info'));
        }

        // Executar testes automaticamente ao carregar
        window.addEventListener('load', testAllResources);
    </script>
</body>
</html> 